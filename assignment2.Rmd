---
title: "Week2-Data Management"
author: "Matthew Onimus"
date: "r lubridate::today()"
output: 
  html_document:
    toc: true
    toc_float:
      collapse: true
      smooth_scrolling: true
    code_folding: show
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r libs}
library(tidyverse)
library(gtsummary)
library(gt)
library(haven)
library(readxl)
library(rlang)
```

# Read in the Data

The first thing I needed to do was read the data in join as per the SAS script.  

```{r readData}

nhanesdemo <- read_sav("assignments/NHANES_2015_DEMO.sav") 
nhanesbmx <- read_csv("assignments/NHANES_2015_BMX_I.csv")
nhaneshosp <- read_excel("assignments/NHANES_2015_HUQ.xlsx")

# note that all the data is not the same legnth

nhanes <- nhanesdemo %>% 
  left_join(nhanesbmx, by = "SEQN") %>% 
  left_join(nhaneshosp, by = "SEQN")

tbl_summary(nhanes)





```

The final, joined data had `r ncol(nhanes)` variables and `r nrow(nhanes)` observations.  A pretty massive dataset.


# 1. Review the frequency table for the number of overnight hospital visits and a histogram,
what is this data and distribution telling you?

```{r q1_dataAndfreq}

nhanes2 <- nhanes %>%
  #select(HUD080, HUQ071) %>% 
  mutate(overnightHosp = HUD080,
         overnightHosp = ifelse(HUQ071==7 | HUQ071==9 | is.na(HUQ071), NA, overnightHosp),
         overnightHosp = ifelse(HUQ071 == 1 & (HUD080 == 77777 | HUD080 == 99999), NA, overnightHosp),
         overnightHosp = ifelse(HUQ071 == 2, 0, overnightHosp),
         waistin = BMXWAIST / 2.54,
         children = 0,
         children = ifelse(DMDHHSZA > 0 | DMDHHSZB > 0, 1, children)
         
  ) 

nhanesChildren <- nhanes2 %>% 
  filter(children == 1)

nhanes2 %>% 
  select(overnightHosp) %>% 
  group_by(overnightHosp) %>% 
  summarise(count = n()) %>% 
  gt()
```

```{r q1_hist}

ggplot(nhanes2, aes(x = overnightHosp)) +
  geom_histogram(bins = 7) +
  theme_classic()

```

The frequency table shows most of the data do not have an overnight hospital stay.  The histogram tells the same story.  There is a large tail to the data showing the skewness.

# 2. What is the median age of respondents? What are the median ages for those who do and do not have a child in the home?

```{r q2}

median(nhanes2$RIDAGEYR)


nhanes2 %>% 
  group_by(children) %>% 
  summarise(count = n(),
            median = median(RIDAGEYR))




```

The median age for all respondents is 27.  The median age for those with children is 14 and without children is 59.

# 3.	What is the average waist circumference (in inches) for those who had 6+ overnight hospital stays in the past year?


```{r q3}

nhanes2 %>% 
  group_by(overnightHosp) %>% 
  summarize(count = n(),
            waist = mean(waistin, na.rm = TRUE)) %>% 
  gt()



```

The average waist size (in inches) for 6 overnight stays is 36.841 inches.






